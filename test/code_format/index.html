<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代码处理工具 - 在线工具箱</title>
    <link rel="stylesheet" href="../../public/style.css">
    <link rel="stylesheet" href="tool.css">
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <style>
        .CodeMirror {
            height: 600px !important;  /* 使用 !important 确保不被覆盖 */
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
    <!-- 首先引入 CodeMirror 核心 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    
    <!-- 然后引入基础依赖 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    
    <!-- 最后引入其他语言模式 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/ruby/ruby.min.js"></script>
</head>
<body>
    <div class="page-wrapper">
        <main class="main">
            <section class="tool-page-hero">
                <div class="container">
                    <h1>代码处理工具</h1>
                    <p>支持JavaScript、CSS、HTML代码的格式化、压缩等处理，让代码更加规范美观</p>
                </div>
            </section>

            <div class="tool-container">
                <div class="tool-main">
                    <div class="file-upload" id="dropZone">
                        <input type="file" id="fileInput" accept=".js,.css,.html,.htm,.py,.sql,.php,.java,.cpp,.c,.rb" style="display: none;">
                        <p>点击或拖拽文件到此处上传</p>
                        <small>支持 .js、.css、.html、.php、.py、.sql、.java、.cpp、.rb 等格式</small>
                    </div>

                    <div class="code-container">
                        <div class="code-editor" ondragover="event.preventDefault();" ondrop="handleFileDrop(event);">
                            <h2>
                                源代码
                                <div style="display: flex; align-items: center; gap: 12px; margin-left: auto;">
                                    <select id="codeType" onchange="updateCodeMode()" style="padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color);">
                                        <option value="auto">自动检测</option>
                                        <option value="javascript">JavaScript</option>
                                        <option value="css">CSS</option>
                                        <option value="htmlmixed">HTML</option>
                                        <option value="python">Python</option>
                                        <option value="sql">SQL</option>
                                        <option value="php">PHP</option>
                                        <option value="java">Java</option>
                                        <option value="clike">C/C++</option>
                                        <option value="ruby">Ruby</option>
                                    </select>
                                    <span class="file-size" id="sourceSize"></span>
                                </div>
                            </h2>
                            <textarea id="source"></textarea>
                            <div id="errorMessage" class="error-message"></div>
                        </div>

                        <div class="code-actions">
                            <button class="btn format" onclick="processCode('format')" title="格式化代码，使其更易读">
                                <svg viewBox="0 0 24 24"><path d="M21 11H3V9H21V11M21 15H3V13H21V15M21 7H3V5H21V7M21 19H3V17H21V19Z"/></svg>
                                格式化
                            </button>
                            <button class="btn remove-comments" onclick="processCode('remove-comments')" title="仅移除代码中的注释">
                                <svg viewBox="0 0 24 24"><path d="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9M10,16V19.08L13.08,16H20V4H4V16H10Z"/></svg>
                                去除注释
                            </button>
                            <button class="btn compress" onclick="processCode('compress')" title="压缩代码，减小体积">
                                <svg viewBox="0 0 24 24"><path d="M19.5,3.09L15,7.59V4H13V11H20V9H16.41L20.91,4.5L19.5,3.09M4,13V15H7.59L3.09,19.5L4.5,20.91L9,16.41V20H11V13H4Z"/></svg>
                                压缩
                            </button>
                            <button class="btn copy" onclick="copyCode()" title="复制到剪贴板">
                                <svg viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                                复制
                            </button>
                            <button class="btn export" onclick="exportCode()" title="导出为文件">
                                <svg viewBox="0 0 24 24"><path d="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,12L16,16H13.5V19H10.5V16H8L12,12Z"/></svg>
                                导出
                            </button>
                            <button class="btn reset" onclick="resetCode()" title="清空编辑器">
                                <svg viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>
                                清空
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tool-info">
                    <h2>功能简介</h2>
                    <p>代码格式化工具支持对JavaScript、CSS和HTML代码进行格式化和压缩处理，帮助开发者快速整理代码结构，提高代码可读性或减小代码体积。</p>
                    
                    <h3>主要功能</h3>
                    <ul>
                        <li>支持多种代码格式（JavaScript、CSS、HTML）的处理</li>
                        <li>提供代码格式化功能，自动调整缩进和换行</li>
                        <li>支持去除注释功能，保留代码结构</li>
                        <li>支持代码压缩，去除注释和多余空白字符</li>
                        <li>支持文件拖拽上传和直接粘贴输入</li>
                    </ul>
                    
                    <h3>使用说明</h3>
                    <ul>
                        <li>通过拖拽、上传或粘贴输入需要处理的代码</li>
                        <li>选择格式化或压缩功能</li>
                        <li>点击相应按钮进行代码处理</li>
                        <li>使用复制或导出功能获取处理后的代码</li>
                    </ul>

                    <h3>注意事项</h3>
                    <ul>
                        <li>格式化会保持代码的完整性，适合开发阶段使用</li>
                        <li>压缩会移除注释和空白字符，适合生产环境使用</li>
                        <li>建议在处理大文件前先备份原始代码</li>
                        <li>代码类型自动检测可能并非完全准确，如有误判请手动选择正确的代码格式</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <div id="toast" class="toast"></div>

    <div id="exportModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-color); padding: 20px; border-radius: 8px; width: 300px; border: 1px solid var(--border-color);">
            <h3 style="margin-bottom: 15px; font-size: 18px; color: var(--text-color);">导出文件</h3>
            <input type="text" id="filename" value="code.js" 
                   style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 15px; background: var(--bg-color); color: var(--text-color);">
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="closeExportModal()" class="btn">取消</button>
                <button onclick="confirmExport()" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- 引入必要的库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    <!-- CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="../../public/main.js"></script>
    <script src="tool.js"></script>

</body>
</html>
